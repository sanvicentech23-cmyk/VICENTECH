<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Maps Test - Fixed</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }
        .map-container {
            margin: 20px 0;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            font-weight: bold;
        }
        .loading {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        #map {
            width: 100%;
            height: 400px;
            border-radius: 12px;
            border: 3px solid #CD8B3E;
            box-shadow: 0 4px 16px rgba(205, 139, 62, 0.15);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Google Maps Integration Test - Fixed Version</h1>
        <div id="status" class="status loading">Loading Google Maps API...</div>
        
        <div class="map-container">
            <div id="map"></div>
        </div>
        
        <div>
            <h3>Test Details:</h3>
            <ul>
                <li>API Key: Using environment variable or fallback</li>
                <li>Libraries: marker (for Advanced Markers)</li>
                <li>Map ID: DEMO_MAP_ID (for Advanced Markers support)</li>
                <li>Fallback: Regular markers if Advanced Markers fail</li>
                <li>Location: Diocesan Shrine of San Vicente Ferrer</li>
            </ul>
        </div>
    </div>

    <script>
        let map;
        let marker;
        const statusDiv = document.getElementById('status');
        
        function updateStatus(message, type) {
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }
        
        function initMap() {
            try {
                updateStatus('Initializing map...', 'loading');
                
                // Check if Google Maps API is loaded
                if (!window.google || !window.google.maps || !window.google.maps.Map) {
                    throw new Error('Google Maps API not loaded');
                }
                
                const churchLocation = { lat: 14.23505, lng: 121.15816 };
                
                // Check if Advanced Markers are available
                const useAdvancedMarkers = window.google.maps.marker && window.google.maps.marker.AdvancedMarkerElement;
                
                const mapConfig = {
                    zoom: 17,
                    center: churchLocation,
                    mapTypeId: 'roadmap',
                    mapTypeControl: true,
                    streetViewControl: true,
                    fullscreenControl: true
                };

                // Only add mapId if we're using Advanced Markers, otherwise use styles
                if (useAdvancedMarkers) {
                    mapConfig.mapId = 'DEMO_MAP_ID';
                    updateStatus('Using Advanced Markers (Map ID: DEMO_MAP_ID)', 'loading');
                } else {
                    mapConfig.styles = [
                        {
                            featureType: 'poi.business',
                            stylers: [{ visibility: 'on' }]
                        },
                        {
                            featureType: 'poi.place_of_worship',
                            stylers: [{ visibility: 'on' }]
                        },
                        {
                            featureType: 'road',
                            elementType: 'labels',
                            stylers: [{ visibility: 'on' }]
                        }
                    ];
                    updateStatus('Using regular markers with custom styles', 'loading');
                }
                
                map = new google.maps.Map(document.getElementById('map'), mapConfig);
                
                // Create marker
                if (useAdvancedMarkers) {
                    try {
                        const markerElement = document.createElement('div');
                        markerElement.innerHTML = `
                            <svg width="60" height="80" viewBox="0 0 24 32" style="filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));">
                                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" 
                                      fill="#FF0000" 
                                      stroke="#FFFFFF" 
                                      stroke-width="1.5"/>
                            </svg>
                        `;
                        
                        marker = new google.maps.marker.AdvancedMarkerElement({
                            position: churchLocation,
                            map: map,
                            title: 'Diocesan Shrine of San Vicente Ferrer',
                            content: markerElement
                        });
                        
                        updateStatus('Map loaded successfully with Advanced Markers!', 'success');
                    } catch (error) {
                        console.warn('Advanced Marker failed, using fallback:', error);
                        createFallbackMarker();
                    }
                } else {
                    createFallbackMarker();
                }
                
                function createFallbackMarker() {
                    marker = new google.maps.Marker({
                        position: churchLocation,
                        map: map,
                        title: 'Diocesan Shrine of San Vicente Ferrer',
                        icon: {
                            path: 'M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z',
                            fillColor: '#FF0000',
                            fillOpacity: 1,
                            strokeColor: '#FFFFFF',
                            strokeWeight: 3,
                            scale: 2.5,
                            anchor: new google.maps.Point(12, 22)
                        }
                    });
                    
                    updateStatus('Map loaded successfully with regular markers!', 'success');
                }
                
                // Add info window
                const infoWindow = new google.maps.InfoWindow({
                    content: `
                        <div style="padding: 15px; font-family: Arial, sans-serif; max-width: 300px;">
                            <h3 style="margin: 0 0 10px 0; color: #CD8B3E; font-size: 18px; font-weight: bold;">
                                Diocesan Shrine of San Vicente Ferrer
                            </h3>
                            <p style="margin: 0 0 8px 0; font-size: 14px; color: #333; font-weight: 500;">
                                üìç Brgy. Mamatid, City of Cabuyao, Laguna
                            </p>
                            <p style="margin: 0 0 8px 0; font-size: 13px; color: #666;">
                                üìû Contact: 09123456789
                            </p>
                            <p style="margin: 0 0 8px 0; font-size: 13px; color: #666;">
                                ‚úâÔ∏è Email: sanvicenteferrer@gmail.com
                            </p>
                        </div>
                    `
                });
                
                marker.addListener('click', () => {
                    infoWindow.open(map, marker);
                });
                
            } catch (error) {
                console.error('Error initializing map:', error);
                updateStatus(`Error: ${error.message}`, 'error');
            }
        }
        
        function loadGoogleMaps() {
            return new Promise((resolve, reject) => {
                // Check if already loaded
                if (window.google && window.google.maps) {
                    resolve();
                    return;
                }
                
                updateStatus('Loading Google Maps API script...', 'loading');
                
                const script = document.createElement('script');
                const apiKey = 'AIzaSyB7WohoejX6VDTzttyuTd0nnyZbV1XdgC8'; // Your API key
                script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&libraries=marker&loading=async`;
                script.async = true;
                script.defer = true;
                
                script.onload = () => {
                    // Wait for the API to be fully ready
                    const checkReady = () => {
                        if (window.google && window.google.maps && window.google.maps.Map) {
                            updateStatus('Google Maps API loaded successfully!', 'success');
                            resolve();
                        } else {
                            setTimeout(checkReady, 50);
                        }
                    };
                    checkReady();
                };
                
                script.onerror = () => {
                    updateStatus('Failed to load Google Maps API', 'error');
                    reject(new Error('Failed to load Google Maps API'));
                };
                
                document.head.appendChild(script);
            });
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadGoogleMaps()
                .then(() => {
                    initMap();
                })
                .catch((error) => {
                    console.error('Error loading Google Maps:', error);
                    updateStatus(`Failed to load: ${error.message}`, 'error');
                });
        });
    </script>
</body>
</html>